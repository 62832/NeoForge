--- a/net/minecraft/client/multiplayer/ClientHandshakePacketListenerImpl.java
+++ b/net/minecraft/client/multiplayer/ClientHandshakePacketListenerImpl.java
@@ -44,6 +44,7 @@
 import net.minecraft.world.flag.FeatureFlags;
 import net.neoforged.api.distmarker.Dist;
 import net.neoforged.api.distmarker.OnlyIn;
+import net.neoforged.neoforge.network.ICustomQueryPayloadWithBuffer;
 import org.slf4j.Logger;
 
 @OnlyIn(Dist.CLIENT)
@@ -180,7 +181,7 @@
       if (this.serverData != null && this.serverData.isRealm()) {
          this.minecraft.setScreen(new DisconnectedRealmsScreen(this.parent, CommonComponents.CONNECT_FAILED, p_104543_));
       } else {
-         this.minecraft.setScreen(new DisconnectedScreen(this.parent, CommonComponents.CONNECT_FAILED, p_104543_));
+         this.minecraft.setScreen(net.neoforged.neoforge.network.NetworkHooks.getModMismatchData(connection) != null ? new net.neoforged.neoforge.client.gui.ModMismatchDisconnectedScreen(this.parent, CommonComponents.CONNECT_FAILED, p_104543_, net.neoforged.neoforge.network.NetworkHooks.getModMismatchData(connection)) : new DisconnectedScreen(this.parent, CommonComponents.CONNECT_FAILED, p_104543_));
       }
    }
 
@@ -203,6 +204,7 @@
 
    @Override
    public void handleCustomQuery(ClientboundCustomQueryPacket p_104545_) {
+      if (p_104545_.payload() instanceof ICustomQueryPayloadWithBuffer payload && net.neoforged.neoforge.network.NetworkHooks.onCustomQuery(p_104545_, payload, this.connection)) return;
       this.updateStatus.accept(Component.translatable("connect.negotiating"));
       this.connection.send(new ServerboundCustomQueryAnswerPacket(p_104545_.transactionId(), null));
    }
